/*! pym.js - v1.3.3 - 2018-03-27 */

!function(a){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a():window.pym=a.call(this)}(function(){var a={},b=function(a){console.log("pym:_raiseCustomEvent:args",{eventName:a});var b=document.createEvent("Event");b.initEvent("pym:"+a,!0,!0),console.log("pym:_raiseCustomEvent:event",b),document.dispatchEvent(b)},c=function(a){console.log("pym:_getParameterByName:args",{name:a});var b=new RegExp("[\\?&]"+a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)");console.log("pym:_getParameterByName:regex",b);var c=b.exec(location.search);return console.log("pym:_getParameterByName:location_search",location.search),console.log("pym:_getParameterByName:results",c),null===c?"":(console.log("pym:_getParameterByName:decodeURIComponent",decodeURIComponent(c[1].replace(/\+/g," "))),decodeURIComponent(c[1].replace(/\+/g," ")))},d=function(a,b){return console.log("pym:_isSafeMessage:args",{e:a,settings:b}),"*"===b.xdomain||a.origin.match(new RegExp(b.xdomain+"$"))?(console.log("pym:_isSafeMessage:type_of_data_before_if",typeof a.data),"string"==typeof a.data||void console.log("pym:_isSafeMessage:type_of_data_after_if",typeof a.data)):void console.log("_isSafeMessage:origin_doesnt_match",!a.origin.match(new RegExp(b.xdomain+"$")))},e=function(a){console.log("pym:_isSafeUrl:args",{url:a});var b=/^(?:(?:https?|mailto|ftp):|[^&:\/?#]*(?:[\/?#]|$))/gi;return a.match(b)?(console.log("pym:_isSafeUrl:safe_url",a),!0):void console.log("pym:_isSafeUrl:not_safe_url",!a.match(b))},f=function(a,b,c){console.log("pym:_makeMessage:args",{id:a,messageType:b,message:c});var d=["pym",a,b,c];return console.log("pym:_makeMessage:bits",d),console.log("pym:_makeMessage:joined_bits",d.join("xPYMx")),d.join("xPYMx")},g=function(a){console.log("pym:_makeMessageRegex:args",{id:a});var b=["pym",a,"(\\S+)","(.*)"];return console.log("pym:_makeMessageRegex:bits",b),console.log("pym:_makeMessageRegex:regex",new RegExp("^"+b.join("xPYMx")+"$")),new RegExp("^"+b.join("xPYMx")+"$")},h=Date.now||function(){return(new Date).getTime()},i=function(a,b,c){var d,e,f,g=null,i=0;c||(c={});var j=function(){i=!1===c.leading?0:h(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var k=h();i||!1!==c.leading||(i=k);var l=b-(k-i);return d=this,e=arguments,l<=0||l>b?(g&&(clearTimeout(g),g=null),i=k,f=a.apply(d,e),g||(d=e=null)):g||!1===c.trailing||(g=setTimeout(j,l)),f}},j=function(){var b=a.autoInitInstances.length;console.log("pym:_cleanAutiInitInstances:length",a.autoInitInstances.length);for(var c=b-1;c>=0;c--){var d=a.autoInitInstances[c];console.log("pym:_cleanAutoInitInstances:instance_"+c,d),d.el.getElementsByTagName("iframe").length&&d.el.getElementsByTagName("iframe")[0].contentWindow?console.log("pym:_cleanAutoInitInstances:is_contentless // true"):(console.log("_cleanAutoInitInstances:is_contentless // false removing instance",a.autoInitInstances.splice(c,1)),a.autoInitInstances.splice(c,1))}};return a.autoInitInstances=[],a.autoInit=function(c){console.log("pym:lib.autoInit:args",{doNotRaiseEvents:c});var d=document.querySelectorAll("[data-pym-src]:not([data-pym-auto-initialized])");console.log("pym:lib.autoInit:elements[data-pym-src]:not([data-pym-auto-initialized]",d);var e=d.length;j();for(var f=0;f<e;++f){var g=d[f];console.log("pym:lib.autoInit:element_"+f,g),g.setAttribute("data-pym-auto-initialized",""),""===g.id&&(g.id="pym-"+f+"-"+Math.random().toString(36).substr(2,5));var h=g.getAttribute("data-pym-src");console.log("pym:lib.autoInit:src",h);var i={xdomain:"string",title:"string",name:"string",id:"string",sandbox:"string",allowfullscreen:"boolean",parenturlparam:"string",parenturlvalue:"string",optionalparams:"boolean",trackscroll:"boolean",scrollwait:"number"},k={};for(var l in i)if(null!==g.getAttribute("data-pym-"+l))switch(i[l]){case"boolean":k[l]=!("false"===g.getAttribute("data-pym-"+l)),console.log("lib.autoInit: boolean config["+l+"]",k[l]);break;case"string":k[l]=g.getAttribute("data-pym-"+l),console.log("lib.autoInit: string config["+l+"]",k[l]);break;case"number":var m=Number(g.getAttribute("data-pym-"+l));console.log("pym:lib.autoInit:n",m),isNaN(m)||(k[l]=m);break;default:console.err("unrecognized attribute type")}console.log("pym:lib.autoInit:references",{id:g.id,src:h,config:k});var n=new a.Parent(g.id,h,k);console.log("pym:lib.autoInit:parent",n),a.autoInitInstances.push(n)}return c||b("pym-initialized"),a.autoInitInstances},a.Parent=function(a,b,c){console.log("pym:lib.Parent:args",{id:a,url:b,config:c}),this.id=a,console.log("pym:lib.Parent:id",this.id),this.url=b,console.log("pym:lib.Parent:url",this.url),this.el=document.getElementById(a),console.log("pym:lib.Parent:el",this.el),this.iframe=null,console.log("pym:lib.Parent:iframe",this.iframe),this.settings={xdomain:"*",optionalparams:!0,parenturlparam:"parentUrl",parenturlvalue:window.location.href,trackscroll:!1,scrollwait:100},console.log("pym:lib.Parent:settings",this.settings),this.messageRegex=g(this.id),console.log("pym:lib.Parent:messageRegex",this.messageRegex),this.messageHandlers={},console.log("pym:lib.Parent:messageHandlers",this.messageHandlers),c=c||{},console.log("pym:lib.Parent:ensured_config",this.config),this._constructIframe=function(){var a=this.el.offsetWidth.toString();console.log("pym:lib.Parent:_constructIframe:width",a),this.iframe=document.createElement("iframe"),console.log("pym:lib.Parent:_constructIframe:iframe",this.iframe);var b="",c=this.url.indexOf("#");for(c>-1&&(b=this.url.substring(c,this.url.length),this.url=this.url.substring(0,c)),this.url.indexOf("?")<0?this.url+="?":this.url+="&",console.log("pym:lib.Parent:_constructIframe:hashes_and_url",{hash:b,hashIndex:c,url:this.url}),this.iframe.src=this.url+"initialWidth="+a+"&childId="+this.id,console.log("pym:lib.Parent:_constructIframe:src_generation_pre_optional_params",this.iframe.src),this.settings.optionalparams&&(this.iframe.src+="&parentTitle="+encodeURIComponent(document.title),this.iframe.src+="&"+this.settings.parenturlparam+"="+encodeURIComponent(this.settings.parenturlvalue)),this.iframe.src+=b,console.log("pym:lib.Parent:_constructIframe:src_generation_after_optional_params",this.iframe.src),this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("frameborder","0"),this.settings.title&&this.iframe.setAttribute("title",this.settings.title),void 0!==this.settings.allowfullscreen&&!1!==this.settings.allowfullscreen&&this.iframe.setAttribute("allowfullscreen",""),void 0!==this.settings.sandbox&&"string"==typeof this.settings.sandbox&&this.iframe.setAttribute("sandbox",this.settings.sandbox),this.settings.id&&(document.getElementById(this.settings.id)||this.iframe.setAttribute("id",this.settings.id)),this.settings.name&&this.iframe.setAttribute("name",this.settings.name),console.log("pym:lib.Parent:_constructIframe:updated_settings",this.iframe.attributes);this.el.firstChild;)this.el.removeChild(this.el.firstChild);this.el.appendChild(this.iframe),window.addEventListener("resize",this._onResize),this.settings.trackscroll&&window.addEventListener("scroll",this._throttleOnScroll)},this._onResize=function(){this.sendWidth(),this.settings.trackscroll&&this.sendViewportAndIFramePosition()}.bind(this),this._onScroll=function(){this.sendViewportAndIFramePosition()}.bind(this),this._fire=function(a,b){if(console.log("pym:lib.Parent:_fire:args",{messageType:a,message:b,messageHandlers:this.messageHandlers}),a in this.messageHandlers)for(var c=0;c<this.messageHandlers[a].length;c++)this.messageHandlers[a][c].call(this,b)},this.remove=function(){window.removeEventListener("message",this._processMessage),console.log("pym:lib.Parent:remove:eventListener:message removed!"),window.removeEventListener("resize",this._onResize),console.log("pym:lib.Parent:remove:eventListener:resize removed!"),this.el.removeChild(this.iframe),console.log("pym:lib.Parent:remove:child",this.iframe),console.log("pym:lib.Parent:cleaningAutoInitInstances start"),j(),console.log("pym:lib.Parent:cleaningAutoInitInstances finish")},this._processMessage=function(a){if(console.log("pym:lib.Parent:_processMessage:args",{e:a}),!d(a,this.settings))return void console.log("pym:lib.Parent:_processMessage:_isSafeMessage:false:args",{e:a,settings:this.settings});if("string"!=typeof a.data)return void console.log("pym:lib.Parent:_processMessage:discard_object_messages",a.data);var b=a.data.match(this.messageRegex);if(console.log("pym:lib.Parent:_processMessage:match",b),!b||3!==b.length)return console.log("pym:lib.Parent:match_or_too_many_matches",b),!1;var c=b[1],e=b[2];console.log("pym:lib.Parent:process_message_fire:data",{messageType:c,message:e}),this._fire(c,e)}.bind(this),this._onHeightMessage=function(a){console.log("pym:lib.Parent:_onHeightMessage:args",{message:a});var b=parseInt(a);console.log("pym:lib.Parent:_onHeightMessage:new_height",b),this.iframe.setAttribute("height",b+"px")},this._onNavigateToMessage=function(a){if(console.log("pym:lib.Parent:_onNavigateToMessage:args",{message:a}),!e(a))return void console.log("pym:lib.Parent:_onNavigateToMessage:not_safe_url",a);console.log("pym:lib.Parent:_onNavigateToMessage:document_location_href",a),document.location.href=a},this._onScrollToChildPosMessage=function(a){var b=document.getElementById(this.id).getBoundingClientRect().top+window.pageYOffset,c=b+parseInt(a);window.scrollTo(0,c)},this.onMessage=function(a,b){console.log("pym:lib.Parent:onMessage:args",{messageType:a,callback:b.toString()}),a in this.messageHandlers||(this.messageHandlers[a]=[]),this.messageHandlers[a].push(b)},this.sendMessage=function(a,b){console.log("pym:lib.Parent:sendMessage:args",{messageType:a,message:b}),this.el.getElementsByTagName("iframe").length&&(this.el.getElementsByTagName("iframe")[0].contentWindow?(console.log("pym:lib.Parent:sendMessage:postMessage",{id:this.id,messageType:a,message:b}),this.el.getElementsByTagName("iframe")[0].contentWindow.postMessage(f(this.id,a,b),"*")):(console.log("pym:lib.Parent:sendMessage:removeChild removing contentless child"),this.remove()))},this.sendWidth=function(){var a=this.el.offsetWidth.toString();console.log("pym:lib.Parent:sendWidth:message_width",a),this.sendMessage("width",a)},this.sendViewportAndIFramePosition=function(){var a=this.iframe.getBoundingClientRect(),b=window.innerWidth||document.documentElement.clientWidth,c=window.innerHeight||document.documentElement.clientHeight,d=b+" "+c;d+=" "+a.top+" "+a.left,d+=" "+a.bottom+" "+a.right,console.log("pym:lib.Parent:sendViewportAndIFramePosition:payload",d),this.sendMessage("viewport-iframe-position",d)};for(var h in c)this.settings[h]=c[h],console.log("pym:lib.Parent:overrides:settings",this.settings);return this._throttleOnScroll=i(this._onScroll.bind(this),this.settings.scrollwait),this.onMessage("height",this._onHeightMessage),this.onMessage("navigateTo",this._onNavigateToMessage),this.onMessage("scrollToChildPos",this._onScrollToChildPosMessage),this.onMessage("parentPositionInfo",this.sendViewportAndIFramePosition),window.addEventListener("message",this._processMessage,!1),this._constructIframe(),this},a.Child=function(a){console.log("pym:lib.Child:args",{config:a}),this.parentWidth=null,console.log("pym:lib.Child:parentWidth",this.parentWidth),this.id=null,console.log("pym:lib.Child:id",this.id),this.parentTitle=null,console.log("pym:lib.Child:parentTitle",this.parentTitle),this.parentUrl=null,console.log("pym:lib.Child:parentUrl",this.parentUrl),this.settings={renderCallback:null,xdomain:"*",polling:0,parenturlparam:"parentUrl"},console.log("pym:lib.Child:settings",this.settings),this.timerId=null,console.log("pym:lib.Child:timerId",this.timerId),this.messageRegex=null,console.log("pym:lib.Child:messageRegex",this.messageRegex),this.messageHandlers={},console.log("pym:lib.Child:messageHandlers",this.messageHandlers),a=a||{},console.log("pym:lib.Child:ensure_config",a),this.onMessage=function(a,b){console.log("pym:lib.Child:onMessage:args",{messageType:a,callback:b.toString()}),a in this.messageHandlers||(this.messageHandlers[a]=[]),this.messageHandlers[a].push(b)},this._fire=function(a,b){if(console.log("pym:lib.Child:_fire:args",{messageType:a,message:b}),a in this.messageHandlers)for(var c=0;c<this.messageHandlers[a].length;c++)console.log("pym:lib.Child:_fire:this.messageHandlers["+a+"]["+c+"]",{itself:this,message:b}),this.messageHandlers[a][c].call(this,b)},this._processMessage=function(a){if(console.log("pym:lib.Child:_processMessage:args",{e:a}),!d(a,this.settings))return void console.log("pym:lib.Child:_processMessage:_isSafeMessage:false:args",{e:a,settings:this.settings});if("string"!=typeof a.data)return void console.log("pym:lib.Child:_processMessage:discard_object_messages",a.data);var b=a.data.match(this.messageRegex);if(console.log("pym:lib.Parent:_processMessage:match",b),!b||3!==b.length)return void console.log("pym:lib.Child:match_or_too_many_matches",b);var c=b[1],e=b[2];console.log("pym:lib.Child:process_message_fire:data",{messageType:c,message:e}),this._fire(c,e)}.bind(this),this._onWidthMessage=function(a){console.log("pym:lib.Child:_onWidthMessage:args",{message:a});var b=parseInt(a);b!==this.parentWidth&&(this.parentWidth=b,this.settings.renderCallback&&this.settings.renderCallback(b),this.sendHeight())},this.sendMessage=function(a,b){console.log("pym:lib.Child:sendMessage:args",{messageType:a,message:b}),console.log("pym:lib.Child:sendMessage:window_parent",window.parent),console.log("pym:lib.Child:sendMessage:message_to_send",{id:this.id,messageType:a,message:b}),window.parent.postMessage(f(this.id,a,b),"*")},this.sendHeight=function(){var a=document.getElementsByTagName("body")[0].offsetHeight.toString();return console.log("pym:lib.Child:sendHeight:height",a),this.sendMessage("height",a),a}.bind(this),this.getParentPositionInfo=function(){console.log("pym:lib.Child:getParentPositionInfo message sent"),this.sendMessage("parentPositionInfo")},this.scrollParentTo=function(a){console.log("pym:lib.Child:scrollParentTo message sent","#"+a),this.sendMessage("navigateTo","#"+a)},this.navigateParentTo=function(a){console.log("pym:lib.Child:navigateParentTo message sent",a),this.sendMessage("navigateTo",a)},this.scrollParentToChildEl=function(a){var b=document.getElementById(a).getBoundingClientRect().top+window.pageYOffset;console.log("pym:lib.Child:scrollParentToChildEl message sent",b),this.scrollParentToChildPos(b)},this.scrollParentToChildPos=function(a){console.log("pym:lib.Child:scrollParentToChildPos message sent",a),this.sendMessage("scrollToChildPos",a.toString())};this.remove=function(){window.removeEventListener("message",this._processMessage),console.log("pym:lib.Child:removeEventListener:message",this._processMessage),this.timerId&&clearInterval(this.timerId)};for(var e in a)this.settings[e]=a[e],console.log("pym:lib.Child:overrides:settings",this.settings);this.id=c("childId")||a.id,console.log("pym:lib.Child:know_child_as_what_id",this.id),this.messageRegex=new RegExp("^pymxPYMx"+this.id+"xPYMx(\\S+)xPYMx(.*)$"),console.log("pym:lib.Child:messageRegex",this.messageRegex);var g=parseInt(c("initialWidth"));return console.log("pym:lib.Child:initialWidthFromUrlParam",g),this.parentUrl=c(this.settings.parenturlparam),console.log("pym:lib.Child:getUrlOfParentFrame",this.parentUrl),this.parentTitle=c("parentTitle"),console.log("pym:lib.Child:getTitleOfParentFrame",this.parentTitle),this.onMessage("width",this._onWidthMessage),window.addEventListener("message",this._processMessage,!1),this.settings.renderCallback&&(console.log("pym:lib.Child:ifRenderCallback_use_width",g),this.settings.renderCallback(g)),this.sendHeight(),this.settings.polling&&(console.log("pym:lib.Child:ifPolling POLL!"),this.timerId=window.setInterval(this.sendHeight,this.settings.polling)),function(a){console.log("pym:lib.Child:_markWhetherEmbedded",{onMarkedEmbeddedStatus:a});var c,d=document.getElementsByTagName("html")[0],e=d.className;console.log("pym:lib.Child:_markWhetherEmbedded:info",{htmlElement:d,newClassForHtml:c,originalHtmlClasses:e});try{c=window.self!==window.top?"embedded":"not-embedded"}catch(a){c="embedded"}console.log("pym:lib.Child:_markWhetherEmbedded:info_after_window_check",{htmlElement:d,newClassForHtml:c,originalHtmlClasses:e}),e.indexOf(c)<0&&(d.className=e?e+" "+c:c,a&&a(c),b("marked-embedded")),console.log("pym:lib.Child:_markWhetherEmbedded:after_does_newClass_exist_in_original_check",{htmlElement:d,newClassForHtml:c,originalHtmlClasses:e})}(a.onMarkedEmbeddedStatus),this},"undefined"!=typeof document&&(console.log("pym:initializedViaDataAttributes"),a.autoInit(!0)),a});